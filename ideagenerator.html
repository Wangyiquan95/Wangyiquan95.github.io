<!DOCTYPE html>
<html lang="en">
<head>
    <title>Research Paper Generator | PubMed Explorer</title>
    <link rel="icon" type="image/png" href="images/favicon/android-chrome-512x512.png" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <style>
        .paper {
            background-color: white;
            padding: 20px;
            margin-top: 20px;
            border-radius: 6px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.05);
        }
        .paper h2 {
            color: #2c3e50;
            margin-top: 0;
        }
        .authors {
            color: #7f8c8d;
            margin-bottom: 15px;
        }
        .journal {
            font-style: italic;
            color: #34495e;
            margin-bottom: 15px;
        }
        .abstract {
            margin-bottom: 15px;
            text-align: justify;
        }
        .keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }
        .keyword {
            background-color: #e0f7fa;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
            color: #0097a7;
        }
        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #7f8c8d;
        }
        .error {
            color: #e74c3c;
            text-align: center;
            padding: 15px;
        }
        .link {
            display: inline-block;
            margin-top: 10px;
            color: #3498db;
            text-decoration: none;
        }
        .link:hover {
            text-decoration: underline;
        }
        .extraction {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f8ff;
            border-left: 4px solid #3498db;
        }
        .extraction h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
        }
    </style>
</head>
<body class="is-preload">

    <!-- Wrapper -->
    <div id="wrapper">

        <!-- Main -->
        <div id="main">
            <div class="inner">

                <!-- Header -->
                <header id="header">
                    <a href="index.html" class="logo"><strong>YIQUAN WANG</strong></a>
                    <ul class="icons">
                        <li><a href="https://twitter.com/Yiquan_W" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
                        <li><a href="facebook.com/yiquanW/" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
                        <li><a href="https://github.com/Wangyiquan95" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
                        <li><a href="https://www.instagram.com/yiquan1995/" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
                        <li><a href="https://www.linkedin.com/in/yiquan-w" class="icon brands fa-linkedin-in"><span class="label">LinkedIn</span></a></li>
                    </ul>
                </header>

                <!-- Content -->
                <section>
                    <header class="main">
                        <h1>Research Paper Generator</h1>
                        <p>Generate a random research paper from PubMed based on your search term.</p>
                        <!-- <h2 style="text-align: center; color: #666; margin-top: -20px; margin-bottom: 20px; font-size: 1.2em;">PubMed Explorer</h2> -->
                    </header>

                    <div class="controls">
                        <input type="text" id="searchTerm" placeholder="Enter keywords (e.g., cancer, diabetes)" value="keyword">
                        <select id="resultCount">
                            <option value="10">Top 10</option>
                            <option value="20">Top 20</option>
                            <option value="50">Top 50</option>
                            <option value="100">Top 100</option>
                        </select>
                        <button id="fetchButton" class="button primary">Fetch Random Paper</button>
                    </div>

                    <div id="results">
                        <div class="loading" style="display: none;">Loading paper from PubMed...</div>
                        <div class="error" style="display: none;"></div>
                        <div id="paperContent"></div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Sidebar -->
        <div id="sidebar">
            <div class="inner">

                <!-- Search -->
                <section id="search" class="alt">
                    <form id="form" role="search">
                        <input type="text" name="query" id="query" placeholder="Search" aria-label="Search through site content"/>
                    </form>
                </section>

                <!-- Menu -->
                <nav id="menu">
                    <header class="major">
                        <h2>Menu</h2>
                    </header>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="about.html">About me</a></li>
                        <li><a href="research.html">Research</a></li>
                        <li><a href="ideagenerator.html">Idea Generator</a></li>
                        <li><a href="database.html">Database</a></li>
                        <li><a href="BIO-GAME.html">BIO-GAMEe</a></li>
                        <li>
                            <span class="opener">Bio-art</span>
                            <ul>
                                <li><a href="biopainting.html">Bio-painting</a></li>
                                <li><a href="3Dmodel.html">3Dmodel</a></li>
                                <li><a href="cover.html">Cover</a></li>
                                <li><a href="biovideo.html">Bio-video</a></li>
                            </ul>
                        </li>
                    </ul>
                </nav>

                <!-- Section -->
                <section>
                    <header class="major">
                        <h2>Get in touch</h2>
                    </header>
                    <p>leave me a message</p>
                    <ul class="contact">
                        <li class="icon solid fa-envelope"><a href="mailto:yiquan2@illinois.edu">yiquan2@illinois.edu</a></li>
                        <li class="icon solid fa-phone">(217) 721-4325</li>
                    </ul>
                </section>

                <!-- Footer -->
                <footer id="footer">
                    <p class="copyright">&copy; Yiquan Wang. All rights reserved. </p>
                </footer>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fetchButton = document.getElementById('fetchButton');
            const searchTermInput = document.getElementById('searchTerm');
            const resultCountSelect = document.getElementById('resultCount');
            const loadingDiv = document.querySelector('.loading');
            const errorDiv = document.querySelector('.error');
            const paperContentDiv = document.getElementById('paperContent');

            fetchButton.addEventListener('click', fetchRandomPaper);

            async function fetchRandomPaper() {
                // Clear previous results and show loading
                paperContentDiv.innerHTML = '';
                errorDiv.style.display = 'none';
                errorDiv.textContent = '';
                loadingDiv.style.display = 'block';

                try {
                    const searchTerm = searchTermInput.value.trim() || 'recent';
                    const resultCount = resultCountSelect.value;

                    // Step 1: Search for papers
                    const searchResponse = await fetch(`https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term=${encodeURIComponent(searchTerm)}&retmax=${resultCount}&sort=pub+date&retmode=json`);
                    const searchData = await searchResponse.json();

                    if (!searchData.esearchresult || !searchData.esearchresult.idlist || searchData.esearchresult.idlist.length === 0) {
                        throw new Error('No papers found for the given search term.');
                    }

                    // Step 2: Pick a random paper ID
                    const ids = searchData.esearchresult.idlist;
                    const randomIndex = Math.floor(Math.random() * ids.length);
                    const randomId = ids[randomIndex];

                    // Step 3: Fetch the paper details
                    const detailsResponse = await fetch(`https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pubmed&id=${randomId}&retmode=xml`);
                    const detailsText = await detailsResponse.text();

                    // Parse XML
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(detailsText, "text/xml");

                    // Extract paper information
                    const paper = extractPaperInfo(xmlDoc);

                    // Display the paper
                    displayPaper(paper);

                } catch (error) {
                    console.error('Error fetching paper:', error);
                    errorDiv.textContent = `Error: ${error.message || 'Failed to fetch paper from PubMed'}`;
                    errorDiv.style.display = 'block';
                } finally {
                    loadingDiv.style.display = 'none';
                }
            }

            function extractPaperInfo(xmlDoc) {
                // Extract title
                const titleElement = xmlDoc.querySelector('ArticleTitle');
                const title = titleElement ? titleElement.textContent : 'No title available';

                // Extract authors
                const authorElements = xmlDoc.querySelectorAll('Author');
                const authors = Array.from(authorElements).map(author => {
                    const lastName = author.querySelector('LastName')?.textContent || '';
                    const foreName = author.querySelector('ForeName')?.textContent || '';
                    return `${lastName} ${foreName}`.trim();
                }).join(', ');

                // Extract journal info
                const journalTitle = xmlDoc.querySelector('Journal Title')?.textContent ||
                                    xmlDoc.querySelector('ISOAbbreviation')?.textContent || 'Unknown Journal';
                const pubDate = xmlDoc.querySelector('PubDate Year')?.textContent ||
                               xmlDoc.querySelector('PubDate')?.textContent || 'Unknown Date';

                // Extract abstract
                const abstractElement = xmlDoc.querySelector('AbstractText');
                const abstract = abstractElement ? abstractElement.textContent : 'No abstract available';

                // Extract PMID for link
                const pmidElement = xmlDoc.querySelector('PMID');
                const pmid = pmidElement ? pmidElement.textContent : '';

                // Extract keywords
                const keywordElements = xmlDoc.querySelectorAll('Keyword');
                const keywords = Array.from(keywordElements).map(keyword => keyword.textContent);

                // Extract research findings
                const researchFindings = extractResearchFindings(abstract);

                return {
                    title,
                    authors,
                    journal: journalTitle,
                    pubDate,
                    abstract,
                    pmid,
                    keywords,
                    researchFindings
                };
            }

            function extractResearchFindings(abstract) {
                // This is a simple extraction - in a real application, you might use NLP
                const findings = {
                    objective: findSentenceContaining(abstract, ['objective', 'aim', 'purpose', 'goal']),
                    methods: findSentenceContaining(abstract, ['method', 'procedure', 'approach', 'technique']),
                    results: findSentenceContaining(abstract, ['result', 'finding', 'outcome', 'showed', 'demonstrated']),
                    conclusion: findSentenceContaining(abstract, ['conclusion', 'conclude', 'summary', 'suggest'])
                };

                return findings;
            }

            function findSentenceContaining(text, keywords) {
                if (!text) return 'Not found';

                // Split text into sentences
                const sentences = text.split(/(?<=[.!?])\s+/);

                // Find sentences containing any of the keywords
                for (const keyword of keywords) {
                    const matchingSentence = sentences.find(sentence =>
                        sentence.toLowerCase().includes(keyword.toLowerCase())
                    );

                    if (matchingSentence) {
                        return matchingSentence.trim();
                    }
                }

                return 'Not explicitly stated';
            }

            function displayPaper(paper) {
                const paperHTML = `
                    <div class="paper">
                        <h2>${paper.title}</h2>
                        <div class="authors">${paper.authors}</div>
                        <div class="journal">${paper.journal} (${paper.pubDate})</div>
                        <div class="abstract">
                            <strong>Abstract:</strong> ${paper.abstract}
                        </div>
                        ${paper.keywords.length > 0 ? `
                            <div class="keywords">
                                ${paper.keywords.map(keyword => `<span class="keyword">${keyword}</span>`).join('')}
                            </div>
                        ` : ''}
                        <a href="https://pubmed.ncbi.nlm.nih.gov/${paper.pmid}" target="_blank" class="link">View on PubMed</a>

                        <div class="extraction">
                            <h3>Research Extraction</h3>
                            <p><strong>Objective:</strong> ${paper.researchFindings.objective}</p>
                            <p><strong>Methods:</strong> ${paper.researchFindings.methods}</p>
                            <p><strong>Results:</strong> ${paper.researchFindings.results}</p>
                            <p><strong>Conclusion:</strong> ${paper.researchFindings.conclusion}</p>
                        </div>
                    </div>
                `;

                paperContentDiv.innerHTML = paperHTML;
            }
        });
    </script>
</body>
</html>